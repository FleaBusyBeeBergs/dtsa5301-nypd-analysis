---
title: "NYPD Shooting Incident Analysis"
author: "FB"
date: "2024-02-15"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load_libraries, echo=FALSE}

library(tidyverse) 
library(lubridate) 
```


## Introduction

In this video, I present my findings from an analysis of the New York Police Department's Shooting Incident data set. This data is openly available to the public at this website:

**https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD**


## Questions of interest:

* What is going on?

* Who is most affected?

* Where do the incidents occur?

* When do these incidents occur?

* Why is this happening?

## What is going on?

* NYPD has collected and provided data on the city's shooting incidents

* Data includes:

  * Dates & times
  
  * Locations
  
  * Victim demographics
  
  * Perpetrator demographics
  
## What is going on?

Why conduct this analysis in the first place?

* Public safety
  * Around 1,700 victims in 2022

* Prevention of gun violence

* Identify patterns to target resources

## ...
```{r load_data, echo=FALSE}

# reference 1

url <- 'https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD'

nypd_df <- read_csv(url)
``` 
## A note about the data

Victim sex and race categories reflect the way in which the data was collected.

People are vibrant and diverse! I do not suggest that:

* A person's gender is binary

* A person's ethnic identity can fit neatly into a specified category

## ...

```{r location_desc_column_cleaning, echo=FALSE}
# reference 2
nypd_df$LOCATION_DESC <- ifelse(is.na(nypd_df$LOCATION_DESC) | nypd_df$LOCATION_DESC == "(null)", "NONE", nypd_df$LOCATION_DESC)
```

```{r combine location desc, echo=FALSE}

loc_list <- c('NONE', 'MULTI DWELL - PUBLIC HOUS', 'MULTI DWELL - APT BUILD', 'PVT HOUSE')

nypd_df <- nypd_df %>% 
  mutate(LOCATION_DESC = ifelse(LOCATION_DESC %in% loc_list, LOCATION_DESC, 'BUSINESS / OTHER'))
```

```{r remove_staten_island, echo=FALSE}

nypd_df <- subset(nypd_df, BORO != 'STATEN ISLAND')
```

```{r remove_age_unknowns, echo=FALSE}

nypd_df <- subset(nypd_df, !(VIC_AGE_GROUP %in% c('UNKNOWN', '1022')))
```

```{r remove_vic_sex_unknowns, echo=FALSE}

nypd_df <- subset(nypd_df, VIC_SEX != 'U')
```

## Who is most affected?

```{r vic_demo_plot, echo=FALSE}

vic_demo_plot <- ggplot(nypd_df, aes(VIC_RACE, fill = VIC_AGE_GROUP)) +
geom_bar(stat = 'count', position = 'dodge') +
facet_wrap(~ VIC_SEX) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
xlab("Victim's recorded race") +
ylab('Number of shootings') +
labs(fill = 'Age Group') +
ggtitle("Victim's demographics")
```

```{r vic_demographics}

plot(vic_demo_plot)
```

## Who is most affected?

* Males account for 90% of the victims of shootings

* 18 to 24 years old, and 25 to 44 years old

* People who are black make up a large proportion of the victims

## Where do these incidents occur?

```{r location_plot, echo=FALSE}

loc_plot <- ggplot(nypd_df, aes(BORO, fill = VIC_AGE_GROUP)) +
  geom_bar(stat = 'count', position = 'dodge') +
  facet_grid(. ~ LOCATION_DESC) +
  theme(plot.margin = margin(l = 0, r = 0, unit = "pt"),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
        strip.text.x = element_text(angle = 90, vjust = 0.5, hjust = 0)) +
  xlab('Boro') +
  ylab('Count') +
  labs(fill = 'Age Group') +
  ggtitle('Locations of New York City shooting incidents')
```

```{r locations}

plot(loc_plot)
```

## Where do these incidents occur?

* Brooklyn and the Bronx have the highest number of incidents

* Most incidents don't have a specific location listed


## When do these incidents occur?

```{r date_data_type, echo=FALSE}

nypd_df$OCCUR_DATE <- mdy(nypd_df$OCCUR_DATE)

nypd_df$Year <- lubridate::year(nypd_df$OCCUR_DATE)
nypd_df$Month <- lubridate::month(nypd_df$OCCUR_DATE, label = TRUE)
nypd_df$DayOfWeek <- lubridate::wday(nypd_df$OCCUR_DATE, label = TRUE)
nypd_df$HourOfDay <- hour(nypd_df$OCCUR_TIME)
```

```{r yearly_plot, echo=FALSE}

year_plot <- ggplot(nypd_df, aes(x = Year)) +
  geom_bar(stat = 'count', fill = 'darkred') +
  labs(title = 'Yearly count of New York City shooting incidents 2006 - 2022', x = 'Year', y = 'Count')
```

```{r year_over_year}
plot(year_plot)
```


## When do these incidents occur?

Trends over the years:

* 2006 to 2011 - steady 

* 2011 to 2019 - decreasing
  

* 2020 to 2021 - large increase
  

* 2022 onwards - another decrease?
  
## When do these incidents occur?

```{r annual_trends, echo=FALSE}

year_month_plot <- ggplot(nypd_df, aes(x = Month, colour = factor(Year), group = factor(Year))) +
  geom_point(stat = 'count') +
  geom_line(stat = 'count') +
  labs(title = 'Monthly NYC shooting incidents by year',
       colour = 'Year',
       y = 'Number of shootings')
```         

```{r seasonal_plot}

plot(year_month_plot)
```

## When do these incidents occur?

Seasonal trend:

* Higher number in the summer months

* Lower number in the winter months


## When do these incidents occur?

```{r hourly_heatmap, echo = FALSE}

time_group_df <- nypd_df %>%
  group_by(HourOfDay, DayOfWeek) %>%
  summarize(count = n())

heatmap <- ggplot(time_group_df, aes(x = HourOfDay, y = DayOfWeek, fill = count)) +
  geom_tile() +
  scale_fill_gradient(low = 'white', high = 'darkred') + 
  labs(title = 'Hourly New York City shooting incidents by day of week, 2006 - 2022', x = 'Hour of Day', y = 'Day of Week') 
```

```{r}
plot(heatmap)
```


## When do these incidents occur?

Weekly trend:

* Highest number on late night weekends

* Lowest number on business/school hours weekdays

## A seasonal trend model

```{r feat_engineering, echo = FALSE}

nypd_df$Month <- as.numeric(nypd_df$Month)
nypd_df$COUNT <- 1
monthly_counts <- aggregate(COUNT ~ Month + Year, data = nypd_df, FUN = sum)
```

```{r model, echo = FALSE}
monthly_counts$Sin_Month <- sin(2 * pi * monthly_counts$Month / 12)
monthly_counts$Cos_Month <- cos(2 * pi * monthly_counts$Month / 12)

model <- lm(COUNT ~ Sin_Month + Cos_Month, data = monthly_counts)
```

## A seasonal trend model

Number of incidents as a function of the month of the year [1]:

* January = 1, Jul = 7, etc.

* shootings = -30.2 * sin * (2 * pi * month)  -  33.4 * cos (2 * pi * month) + 129.5

* Adjusted R-squared = 0.3795

  * 38% of the variance in the # of incidents can be explained by the
month of the year.

* F-statistic = 63.09

  * means the model as a whole is useful in predicting incident counts

## A seasonal trend model

```{r predict, echo = FALSE}

monthly_counts$PRED_COUNT <- predict(model)
```

```{r seasonal_plot_model, echo=FALSE}

seasonal_plot <- ggplot(monthly_counts) +
  geom_point(aes(x = Month, y = COUNT, colour = 'Actual'), alpha = 0.5) +
  geom_point(aes(x = Month, y = PRED_COUNT, colour = 'Predicted'), size = 3) +
  labs(x = 'Month', y = 'Number of shootings', 
       title = 'Observed vs. Predicted Counts of Monthly NYC Shooting Incidents') +
  scale_colour_manual(values = c('Actual' = 'darkred', 'Predicted' = 'blue'),
                      labels = c('Actual', 'Predicted')) +
  theme_minimal()
```

```{r model_plot}

plot(seasonal_plot)
```

Not a bad fit!



## Why is this happening?

Things to consider that are in the dataset:

Most of the shootings do not have a specific location listed and occur very late at night on the weekends.

  * This could be an indication of participation in illegal activities. 

We cannot know for sure. More information is needed!

## Why is this happening?

Possible causes - I don't know, but raises more questions:

  * Marginalized persons?

  * Disadvantaged communities?
  
  * Lack of opportunities?
  

## Why is this happening?

Consult those with knowledge:

* Health care providers

* Social advocacy groups

* Neighbourhood community associations

* Educators

* Sociologists and criminologists

* Government and law enforcement

## What to do? Further study:

* Gather more information from the 'experts'

* Add variables to the model

* Put the model to use:

  * Budget meeting, grant applications, social programming
  * Ambulance and Hospital ER staffing
  * Law enforcement scheduling

## Summary

* Victims are mostly male, between the ages of 18 to 44, and Black.

* Brooklyn and the Bronx have the highest number of shooting incidents, with no specific location provided.

* Shooting incidents were on the decline between 2011 and 2019, with a big spike in 2020.

* Seasonal trend

* Late night weekends

## References

1. Sinusoidal wave modeling, Stack Exchange:
  * https://stats.stackexchange.com/questions/60500/how-to-find-a-good-fit-for-semi-sinusoidal-model-in-r
  

  






























